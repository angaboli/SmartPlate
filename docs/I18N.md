# SmartPlate — Internationalization (i18n)

> **Version**: 1.0
> **Last updated**: 2026-01-28
> **Languages**: English (en), French (fr)

---

## Architecture

### Current Implementation
The app uses a custom `LanguageContext` with a `t(key)` function. Translations are stored as TypeScript objects in `LanguageContext.tsx`.

### Target Implementation (M8)
- Translations extracted to JSON files: `src/locales/en.json`, `src/locales/fr.json`
- `LanguageContext` loads from JSON files
- Language persisted in `localStorage` (immediate) + user settings API (synced)
- Date formatting via `date-fns` locale
- API errors returned as keys, resolved on frontend

---

## Translation File Structure

```
packages/web/src/locales/
├── en.json
└── fr.json
```

### Key Naming Convention

Keys use dot-separated namespaces:

```
{namespace}.{section}.{element}
```

| Namespace | Description | Example |
|---|---|---|
| `nav` | Navigation items | `nav.home`, `nav.aiCoach` |
| `common` | Shared UI elements | `common.save`, `common.cancel` |
| `import` | Import recipe flow | `import.title`, `import.fetch` |
| `cookLater` | Cook Later feature | `cookLater.title`, `cookLater.empty` |
| `recipes` | Recipes page | `recipes.title`, `recipes.search` |
| `profile` | Profile page | `profile.tabProfile`, `profile.tabGoals` |
| `tag` | Meal type tags | `tag.breakfast`, `tag.lunch` |
| `auth` | Authentication | `auth.login`, `auth.register` |
| `dashboard` | AI Coach dashboard | `dashboard.trackMeal`, `dashboard.analyze` |
| `planner` | Weekly planner | `planner.generate`, `planner.grocery` |
| `error` | Error messages | `error.networkError`, `error.unauthorized` |

---

## Usage

### In Components

```tsx
import { useLanguage } from '@/contexts/LanguageContext';

function MyComponent() {
  const { t } = useLanguage();
  return <h1>{t('recipes.title')}</h1>;
}
```

### Language Switcher

The `LanguageSelector` component in the header provides the toggle. Located at:
`packages/web/src/components/LanguageSelector.tsx`

### Persistence Flow

```
User selects language
  │
  ├── Immediately: save to localStorage('smartplate-language')
  ├── Immediately: update LanguageContext state
  └── If authenticated: PATCH /api/v1/users/me/settings { language: "fr" }

On app load:
  │
  ├── Check localStorage
  ├── If authenticated: check user settings from API
  └── Fallback: browser language or "en"
```

---

## Adding New Translation Keys

### Process

1. Add the key to **both** `en.json` and `fr.json`
2. Use the key in the component: `t('namespace.key')`
3. Run the completeness test to verify no missing keys

### Completeness Test

```typescript
// tests/i18n.test.ts
import en from '@/locales/en.json';
import fr from '@/locales/fr.json';

test('all EN keys exist in FR', () => {
  const enKeys = Object.keys(en);
  const frKeys = Object.keys(fr);
  const missing = enKeys.filter(k => !frKeys.includes(k));
  expect(missing).toEqual([]);
});

test('all FR keys exist in EN', () => {
  const enKeys = Object.keys(en);
  const frKeys = Object.keys(fr);
  const extra = frKeys.filter(k => !enKeys.includes(k));
  expect(extra).toEqual([]);
});
```

---

## Date & Number Formatting

### Dates
Use `date-fns` with locale:

```tsx
import { format } from 'date-fns';
import { enUS, fr } from 'date-fns/locale';

const locale = language === 'fr' ? fr : enUS;
format(date, 'PPP', { locale });
// EN: "January 28, 2026"
// FR: "28 janvier 2026"
```

### Numbers
Use `Intl.NumberFormat`:

```tsx
new Intl.NumberFormat(language === 'fr' ? 'fr-FR' : 'en-US').format(2000);
// EN: "2,000"
// FR: "2 000"
```

---

## API Integration

### Request Headers
Frontend sends `Accept-Language: en` or `Accept-Language: fr` with every API request.

### Error Messages
API returns error keys (not hardcoded strings):

```json
{
  "statusCode": 422,
  "error": "Unprocessable Entity",
  "message": "error.validation.invalidEmail"
}
```

Frontend resolves: `t('error.validation.invalidEmail')` → "Invalid email format" or "Format d'email invalide"

---

## French Translation Notes

- French strings are typically 15-30% longer than English
- Test all UI layouts in FR to catch overflow/wrapping issues
- Use non-breaking spaces before `:`, `;`, `!`, `?` (French typography rule)
- Use proper French quotes: `<< >>` (guillemets) not `" "`
- Accent characters must be correct: `e`, `e`, `e`, `a`, `u`, `o`, `i`, `c`

---

## Current Translation Keys

Defined in `src/contexts/LanguageContext.tsx`, will be migrated to JSON files.

### Existing Keys (M0 baseline)

```
nav.home, nav.aiCoach, nav.recipes, nav.profile, nav.menu
common.save, common.cancel, common.edit, common.delete, common.close
common.loading, common.error, common.success
import.title, import.button, import.subtitle, import.placeholder
import.fetch, import.fetching, import.partialDetection, import.invalidLink
import.saved, import.source, import.author, import.prepTime
import.ingredients, import.steps, import.addToCookLater
cookLater.title, cookLater.subtitle, cookLater.empty, cookLater.emptyDesc
cookLater.open, cookLater.addToPlanner, cookLater.remove
cookLater.markCooked, cookLater.addedOn
tag.breakfast, tag.lunch, tag.dinner, tag.snack
recipes.title, recipes.subtitle, recipes.search, recipes.safariTasteOnly
recipes.allGoals, recipes.aiRecommended, recipes.allRecipes
recipes.noResults, recipes.noResultsDesc
profile.title, profile.subtitle, profile.tabProfile, profile.tabGoals
profile.tabPreferences, profile.tabCookLater
```

### Keys to Add (by milestone)

| Milestone | New Key Namespaces |
|---|---|
| M2 | `auth.*` (login, register, errors) |
| M3 | `recipes.*` (detail page, pagination) |
| M6 | `dashboard.*` (analysis, suggestions, meal input) |
| M7 | `planner.*` (generate, grocery, drag-drop) |
| M8 | Comprehensive audit of all hardcoded strings |
